<!-- SEO -->
<app-seo
  [pageTitle]="'nav.genai-sessions' | translate : { name: session()?.session_name || ('new-session' | translate) }"
  [description]="'This is the sessions page of the AI product app.'" [keywords]="'sessions, ai, analytics'"
  (titleChange)="onTitleChange($event)">
</app-seo>

<div class="session-page-container">

  <mat-card appearance="outlined" class="project-shell">
    <!--     <mat-card-header>
      <div mat-card-avatar class="avatar-folder">
        <mat-icon>folder_special</mat-icon>
      </div>
      <mat-card-title>{{ pageTitle() }} {{ session()?.session_name || ('new-session' | translate) }}</mat-card-title>
      <mat-card-subtitle>
        {{ pageDescription() | translate }}
      </mat-card-subtitle>
    </mat-card-header> -->

    <mat-card-content>
      <!-- Loading State -->
      @if (loading()) {
      <div class="loading-state">
        <mat-spinner diameter="64"></mat-spinner>
        <p>{{ 'loading' | translate }}</p>
      </div>
      }

      <!-- Error State -->
      @else if (error()) {
      <div class="error-state">
        <mat-icon>error</mat-icon>
        <h3>{{ 'projects.error.failed-to-load-session' | translate }}</h3>
        <p>{{ error() }}</p>
      </div>
      }
      <!-- Templates Content -->
      @else if (enabledTemplates().length > 0) {
      <div class="templates-container">
        <!-- Single Template (No Tabs) -->
        @if (enabledTemplates().length === 1) {
        @if (session()?.session_id && project()) {
        <app-template-loader [config]="enabledTemplates()[0]" (templateError)="onTemplateError($event)"
          [sessionId]="sessionId() || ''" [projectId]="projectId() || ''"
          [templateId]="enabledTemplates()[0]?.templateId || ''" />
        }
        }

        <!-- Multiple Templates (Tabs) -->
        @else {
        <mat-tab-group [selectedIndex]="selectedTabIndex()" (selectedIndexChange)="selectedTabIndex.set($event)"
          animationDuration="300ms" class="templates-tabs">
          @for (template of enabledTemplates(); track trackByTemplateId($index, template)) {
          <mat-tab>
            <ng-template mat-tab-label>
              <span class="tab-label">{{ template?.type | translate }}</span>
            </ng-template>

            <div class="tab-content">
              @if (session()?.session_id && project()) {
              <app-template-loader [config]="template" (templateError)="onTemplateError($event)"
                [sessionId]="sessionId() || ''" [projectId]="projectId() || ''"
                [templateId]="template?.templateId || ''" />
              }
            </div>
          </mat-tab>
          }
        </mat-tab-group>
        }
      </div>
      }

      <!-- No Templates -->
      @else {
      <div class="empty-state">
        <mat-icon>inbox</mat-icon>
        <h3>{{ 'chat.noTemplates.title' | translate }}</h3>
        <p>{{ 'chat.noTemplates.description' | translate }}</p>
      </div>
      }
    </mat-card-content>
  </mat-card>
</div>
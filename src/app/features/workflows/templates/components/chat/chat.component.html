<div class="chat-container" [class.dark]="(isDark$ | async)">
  <!-- Header -->
  <div class="chat-header">
    <div class="chat-header-info">
      <mat-icon [color]="(isDark$ | async) ? 'accent' : 'primary'">chat</mat-icon>
      <span class="chat-title">{{ 'chatTpl.title' | translate }}</span>
    </div>
    <div class="chat-header-actions">
      <button
        mat-icon-button
        [matTooltip]="'chatTpl.scrollToBottom' | translate"
        (click)="scrollToBottom()"
        [disabled]="disabled"
        class="success"
      >
        <mat-icon>arrow_downward</mat-icon>
      </button>
      <button
        mat-icon-button
        [matTooltip]="'chatTpl.clear' | translate"
        (click)="clearChat()"
        [disabled]="disabled || isEmpty()"
        class="accent"
      >
        <mat-icon>delete_sweep</mat-icon>
      </button>
    </div>
  </div>

  <!-- Messages Container -->
  <div
    #messagesContainer
    class="chat-messages" 
    [class.empty]="isEmpty()"
        [attr.aria-label]="'chatTpl.messages' | translate"
  >
    <!-- Empty State -->
    @if (isEmpty()) {
      <div class="chat-empty">
        <mat-icon>chat_bubble_outline</mat-icon>
        <p>{{ effectiveEmptyMessage$() | translate }}</p>
      </div>
    }

    <!-- Messages List -->
    @if (!isEmpty()) {
      <div class="messages-list">
        @for (message of messages$(); track trackByMessageId($index, message)) {
          <app-chat-message-tpl
            [message]="message"
            [currentUserId]="currentUser$().id"
            [showTimestamp]="config$().showTimestamps !== false"
            [showAvatar]="config$().showAvatars !== false"
            [allowMarkdown]="config$().allowMarkdown !== false"
            [allowEdit]="config$().allowEdit !== false && canEditDelete$()"
            [allowDelete]="config$().allowDelete !== false && canEditDelete$()"
            [isDark]="(isDark$ | async) || false"
            (edit)="onEditMessage($event.id, $event.content)"
            (delete)="onDeleteMessage($event)"
          ></app-chat-message-tpl>
        }

        <!-- Typing Indicator -->
        @if (isTyping$()) {
      <div class="chat-typing">
        <div class="typing-indicator">
          <span></span>
          <span></span>
          <span></span>
        </div>
        <span class="typing-text">{{ 'chatTpl.typing' | translate }}</span>
      </div>
        }
      </div>
    }
  </div>
  <!-- Input Area -->
  <div class="chat-footer">
    <app-chat-input-tpl
      [disabled]="!canSendMessage$() || disabled"
      [maxLength]="effectiveMaxLength$()"
      [placeholder]="effectivePlaceholder$()"
      [enableAttachments]="config$().enableAttachments === true"
      [acceptedFileTypes]="config$().acceptedFileTypes || ''"
      [maxFiles]="config$().maxFiles || 5"
      [allowMultipleFiles]="(config$().maxFiles || 5) > 1"
      [loading]="isLoading$()"
      (send)="onSendMessage($event)"
    ></app-chat-input-tpl>
  </div>

  <!-- Loading Overlay -->
  @if (isLoading$()) {
    <div class="loading-overlay">
      <mat-spinner diameter="40"></mat-spinner>
    </div>
  }
</div>
<div class="run-panel" [attr.data-node-id]="nodeId">
    <div class="header-container">
        <div class="header">
            <mat-icon >output_circle</mat-icon>
            <div class="title">{{ 'workflow.runPanel.title' | translate : { default: 'Run' } }}</div>
        </div>
        <div class="tools">
            <button mat-flat-button class="success" (click)="triggerRun()" [disabled]="!graphOk()">
                <mat-icon class="neutral">play_arrow</mat-icon>
                <span class="ml-2">{{ 'workflow.runPanel.run' | translate : { default: 'Run simulation' } }}</span>
            </button>

            <button mat-icon-button (click)="closePanel()" [matTooltip]="'close' | translate" [color]="(isDark$ |async) ?'neutral': 'primary' ">
                <mat-icon>{{'close'}}</mat-icon>
            </button>
            <button mat-icon-button (click)="collapsed.set(!collapsed())"
                [matTooltip]="(collapsed() ? 'untoggle' : 'toggle') | translate" [color]="(isDark$ |async) ?'neutral': 'primary' ">
                <mat-icon>{{ collapsed() ? 'expand_more' : 'expand_less' }}</mat-icon>
            </button>
        </div>
    </div>
    <ng-container *ngIf="!collapsed()">
        <div class="legend">
            <span class="lg lg-queued"><i></i>{{ 'workflow.runPanel.queued' | translate }}</span>
            <span class="lg lg-running"><i></i>{{ 'workflow.runPanel.running' | translate }}</span>
            <span class="lg lg-success"><i></i>{{ 'workflow.runPanel.success' | translate }}</span>
            <span class="lg lg-error"><i></i>{{ 'workflow.runPanel.error' | translate }}</span>
            <span class="lg lg-skipped"><i></i>{{ 'workflow.runPanel.skipped' | translate }}</span>
        </div>

        @if (runs().length) {
        <div class="body" style="display:flex; flex-direction:column; gap:16px;">
            @for (r of runs(); track r.id; let i = $index) {
            <div class="run-block">
                <div class="run-block__header">
                    <div class="run-meta">
                        <strong>Run #{{ runs().length - i }}</strong>
                        <span>• {{ r.startedAt | date:'short' }}</span>
                        <span>• {{ r.workflow.name }}</span>
                    </div>
                </div>

                <app-pipeline-progress [workflow]="r.workflow" [runState]="r.state"
                    (stageCancel)="stageCancel(r.id, $event)" (pipelineCancel)="pipelineCancel(r.id)">
                </app-pipeline-progress>
            </div>
            }
        </div>
        } @else {
        <div class="empty">
            {{ 'workflow.runPanel.empty' | translate : { default: 'No pipeline to run yet.' } }}
        </div>
        }
    </ng-container>

</div>